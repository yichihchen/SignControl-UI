<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>index</title>
  <script type="module" crossorigin src="/SignControl-UI/assets/main-c10a768f.js"></script>
  <link rel="stylesheet" href="/SignControl-UI/assets/main-7f630f40.css">
</head>

<body>
  <div class="container-fluid header d-flex justify-content-between py-3">
    <div class="d-flex align-items-center">
        <div class="logo"></div>
        <h1 class="text-white p-0">SignControl HoE</h1>
    </div>
    <div class="d-flex align-items-center">
        <div class="account-frame"></div><span class="text-white">Erfan Rezaii</span>
    </div>

</div>    <!-- 標題部分 -->
    <div class="container-fluid px-4">
      <div class="d-flex justify-content-between">
        <div>
          <h2 class="text-white">Display unit </h2>
          <p class="text-white">see your display unit information in here!</p>
          <!-- BS5 下拉式選單 -->
          <select class="form-select" aria-label="Default select example">
            <option selected>Select location group here!</option>
            <option value="1">location group A</option>
            <option value="2">location group B</option>
            <option value="3">location group C</option>
          </select>
        </div>

        <button type="button" class="btn text-white createDisplayUnit" data-bs-toggle="modal"
          data-bs-target="#exampleModalToggle">
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEsSURBVHgB3Za9bsIwFIVPUAUqKhPtQFXWMnUpW9+j78AMGytvw1swMSExsMCMYGICgWAJx8JIJg7g6xiGfNKRI+cqX36ulAvknejWyTiOi1wqTBHurKIoOkAipKjGpcl8wo81M6J4dldIWVPLQjCldGBuFBKyakCZosFr/l4Vkj+E50f3QqqwhvCUmKol5F1U4E6Z+RLU20IhLaYjqC9lFSrK8CCL0IunC18catQH/8flK6zrtZ2o7TNzZBTumA/m1dg7y98TtfUQwi3TS+ypJ2swXQjJf9P4CnfwxOUbpqG6cSyo358PCmmbDqyYoaB+bQn1WLDEY1haQs0I4ZmZM86FkCcWgaXWq782RH3jNGpI/pEmqh8mKnyI/V2hIVZT2xtkbHAaFSVNmCOOHYpCyxqoGi8AAAAASUVORK5CYII=" alt="新增icon" class="pe-2">Create display unit
        </button>
      </div>


      <!-- modal 不只一個 -->

      <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel"
        tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content bg-primary text-white">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalToggleLabel">Modal 1</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Show a second modal and hide this one with the button below.
              <h5>Create display unit</h5>
              <div>
                <p>Location group</p>
                <select class="form-select" aria-label="Default select example">
                  <option selected>Select location group here!</option>
                  <option value="1">location group A</option>
                  <option value="2">location group B</option>
                  <option value="3">location group C</option>
                </select>
              </div>
              <div class="d-flex">
                <div>
                  <p>Display unit model</p>
                  <select class="form-select" aria-label="Default select example">
                    <option selected>Samsung S8 monitor</option>
                    <option value="1">Samsung S5 monitor</option>
                    <option value="2">Samsung S6 monitor </option>
                    <option value="3">Samsung S7 monitor </option>
                  </select>
                </div>
                <div>
                  <p>Video port</p>
                  <select class="form-select" aria-label="Default select example">
                    <option selected>HDMI</option>
                    <option value="1">VGA</option>
                  </select>
                </div>
              </div>
              <h5 class="mt-4">Display unit 2</h5>

              <div>
                <p>Display Unit Name</p>
                <input type="text" id="DisplayUnitName" placehoder="type your display unit name">
              </div>
              <div class="d-flex">
                <div>
                  <p>Orientation</p>
                  <div>
                    <select class="form-select" aria-label="Default select example">
                      <option selected>Landscape</option>
                      <option value="1">Portrait</option>
                    </select>
                  </div>
                </div>

                <div>
                  <p>Ratio</p>
                  <!-- input -->
                  <div class="d-flex ratio-input">
                    <div><span>row</span>
                      <input type="number" id="DisplayUnitRow" size="50" name="DisplayUnitRatio1" min="1" max="16">
                    </div>
                    <div><span>column</span>
                      <input type="number" id="DisplayUnitColumn" size="50" name="DisplayUnitRatio2" min="1" max="16">
                    </div>
                  </div>
                </div>
              </div>

              <div class="displayGrid px-4" id="displayGrid">
                <!-- 加入display Unit  在JS -->
              </div>

              <!-- displayTable TR列表 -->
              <div id="displayTableContent">

              </div>

              <!-- modal body end -->
            </div>

            <!-- 新稱有無資料漏掉提醒 -->

            <!-- modal底下按鈕 -->
            <div class="modal-footer">
              <button class="btn btn-primary" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal"
                data-bs-dismiss="modal">Next</button>
            </div>

          </div>
        </div>
      </div>
      <div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2"
        tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalToggleLabel2">Modal 2</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Hide this modal and show the first with the button below.
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="modal"
                data-bs-dismiss="modal">Back</button>
              <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="modal"
                data-bs-dismiss="modal">Save</button>
            </div>
          </div>
        </div>
      </div>
      <a class="btn btn-primary" data-bs-toggle="modal" href="#exampleModalToggle" role="button">Open first modal</a>

      <!-- modal 不只一個 end-->




    </div>
    </div> <!-- container-fluid  -->


    <div class="container">
      <a href="./component.html">component</a>
    </div>



    
      npm
      <script>


        //input:選取DisplayGrid欄和列數量
        const DisplayUnitRow = document.getElementById('DisplayUnitRow');
        const DisplayUnitColumn = document.getElementById('DisplayUnitColumn');
        const saveChanges = document.getElementById('saveChanges');


        //使DisplayUnitRow & DisplayUnitColumn都使用'change'監聽
        DisplayUnitRow.addEventListener('change', handleRowChange);
        DisplayUnitColumn.addEventListener('change', handleRowChange);

        //innerHTML插入目的地
        const displayGrid = document.getElementById('displayGrid');

        const displayTableContent = document.getElementById('displayTableContent');

        //放置Transmitter所產生的陣列，從系統其他頁面直接新增的T設備
        let arrayTransmitter = [];  //拉到外面 由字串改定義成陣列

        //放置Receiver所產生的陣列，從系統其他頁面直接新增的R設備
        let arrayReceiver = [];

        const transmitterData = [1, 2, 3, 4, 5, 6, 7, 8, 9];  //這裡是用來接create Transimitter 那一頁的資料，之後再將Transmitter map物件依據的陣列改為這個就好
        const receiverData = [1, 2, 3, 4];  //這裡是用來接create receiver那一頁的資料，之後再將receiver map物件依據的陣列改為這個就好

        //轉換成Map物件，以利後續map操作
        const tvWallInformation = new Map();


        //render:先插入row 再插入col

        //將row & col儲存到陣列資料內
        const arrayData = [];

        //selectedTransmitter
        const selectedTransmitter = [];


        function handleRowChange() {

          const rowValue = DisplayUnitRow.value;
          const colValue = DisplayUnitColumn.value;
          let template = "";

          // 清空 arrayData
          arrayData.length = 0;

          for (let i = 0; i < rowValue; i++) {
            template = template + `<div class="row row-style" data-rownum="${i + 1}">`;

            for (let j = 0; j < colValue; j++) {
              const colData = `<div class="col col-style border border-1 py-2 m-1 text-center fs-6 rounded" data-rownum="${i + 1}" data-colnum="${j + 1}" id="R${i + 1}C${j + 1}">R${i + 1} C${j + 1}</div>`;
              template = template + colData;
              //將資料存取入陣列
              arrayData.push({
                row: i + 1,
                col: j + 1
              });
            }

            template += `</div>`;
          }
          displayGrid.innerHTML = template;

          console.log(`arrayData${arrayData}`);


          //排列下方的TR配對List
          arrayData.forEach(function (item, index) {

            // 排列下方的 TR 配對 List
            //map: 將T元素映射到新陣列
            arrayTransmitter = arrayData.map(function (item, index) {
              return `<option value="${index + 1}" id="Trow${item.row}col${item.col}value${index + 1}">T${index + 1}</option>`;
            });

            //map: 將R元素映射到新陣列，這裡不一定要依照arrayData *****
            arrayReceiver = arrayData.map(function (item, index) {
              return `<option value="${index + 1}" id="Rrow${item.row}col${item.col}value${index + 1}">R${index + 1}</option>`; //修改:這裡的 arrayData(create receiver) & index要依照source device有幾台來決定
            });
            console.log(`arrayReceiver${arrayReceiver}`);

            //下拉式選單元件
            allDisplayTableContent();


          })
          selectTheWall();

        }


        //將arrayData數量整個拉出來,幾個電視牆下面就有幾個list的功能
        function allDisplayTableContent() {
          let allNumber = "";
          //簡潔，所以宣告變數
          arrayData.forEach(function (item, index) {
            const transmitterList = `<select class="form-select my-2 me-2" aria-label="Default select example" id="Trow${item.row}col${item.col}" disabled><option>選擇 Transmitter${arrayTransmitter.join('')}</option></select>`;
            const receiverList = `<select class="form-select my-2" aria-label="Default select example" id="Rrow${item.row}col${item.col}" disabled><option>選擇 Receiver${arrayReceiver.join('')}</option></select>`;

            //***下面之後修改成sourceDevice***
            const sourceDeviceList = `<select class="form-select my-2" aria-label="Default select example" disabled><option>選擇 Source Device${arrayReceiver.join('')}</option></select>`;


            allNumber += `<div class="d-flex align-items-center"><span>${index + 1}.&nbsp</span>R${item.row}C${item.col}<span class="mx-2"><i class="fa-solid fa-arrow-right"></i></span>${transmitterList}${receiverList}<span class="mx-2"><i class="fa-solid fa-arrow-right"></i></span>${sourceDeviceList}</div>`;
          })
          displayTableContent.innerHTML = allNumber;
        }


        //點擊上方電視牆 >> 呈現背景白色
        //這個功能切記塞到handleRowChange()內 才能執行
        function selectTheWall() {
          const selectTVWall = document.querySelectorAll('.col');
          const selectLists = document.querySelectorAll('select');

          selectTVWall.forEach(function (item) {
            item.addEventListener('click', function (e) {
              selectTVWall.forEach(function (otherItem) {

                //再迴圈一次要清掉反白的css
                otherItem.classList.remove('highlight');
                //先把已反白的col的id抓出來
                console.log(item);

              })
              // 將被點擊的元素加上反白效果
              e.target.classList.add('highlight');

              const targetRownum = e.target.dataset.rownum;  //正確取得data-rownum
              const targetColnum = e.target.dataset.colnum;  //正確取得data-colnum

              console.log(targetRownum);
              console.log(targetColnum);

              //點擊上方電視牆 >> 下方List呈現readonly或可以編輯
              selectLists.forEach(function (e) {
                //先移除所有的readonly
                e.disabled = false;
                //讓點選過的col符合條件的 T & R List 皆可編輯
                if (e.id === `Trow${targetRownum}col${targetColnum}`) {
                  console.log(`Trow${targetRownum}col${targetColnum}`);

                  //取出option內的value(Transmitter) 並執行innerHTML
                  e.addEventListener('change', function () {

                    const key = `R${targetRownum}C${targetColnum}`;
                    const selectedTransmitter = `Transmitter${e.options[e.selectedIndex].value}`; //`Transmitter${e.value}`

                    //背景顏色功能切換
                    //使用for迴圈來移除之前所有的Transmitter背景樣式，預設Transmitter背景種類10種，可依據實際情況調整
                    for (let i = 1; i <= 10; i++) {
                      document.getElementById(`R${targetRownum}C${targetColnum}`).classList.remove(`Transmitter${i}`);
                    }
                    document.getElementById(`R${targetRownum}C${targetColnum}`).classList.add(`${selectedTransmitter}`);

                    //判斷key(colName)有無重複,若沒有則push到tvWallInformation
                    if (!tvWallInformation.has(key)) {
                      tvWallInformation.set(key, {
                        colName: key,
                        transmitterName: selectedTransmitter,
                        receiverName: ''
                      });


                    } else {
                      //若遇到不同的key(colName)，將selectedTransmitter新增到tvWallInformation
                      tvWallInformation.get(key).transmitterName = selectedTransmitter;  //.push(selectedTransmitter)

                    }

                    //抓Map物件裡面的transmitterName & receiverName
                    document.getElementById(key).innerHTML = `${key}<br>${(tvWallInformation.get(key).transmitterName)}&nbsp&nbsp${(tvWallInformation.get(key).receiverName)}`;

                    console.log(`Transmitter${e.value}`);
                    console.log(`arrayTransmitter${arrayTransmitter}`);

                  })



                } else if (e.id === `Rrow${targetRownum}col${targetColnum}`) {
                  console.log(`Rrow${targetRownum}col${targetColnum}`);

                  //取出option內的value(Reciever) 並執行innerHTML
                  e.addEventListener('change', function () {

                    const selectedReceiver = `Receiver${e.options[e.selectedIndex].value}`;
                    const key = `R${targetRownum}C${targetColnum}`;

                    //判斷key(colName)有無重複，若沒有，則取得另外一個selectedReceiver
                    if (!tvWallInformation.has(key)) {
                      tvWallInformation.set(key, {
                        colName: key,
                        transmitterName: '',
                        receiverName: selectedReceiver
                      });


                    } else {
                      //取得另外一個selectedReceiver
                      tvWallInformation.get(key).receiverName = selectedReceiver;

                    }

                    //抓Map物件裡面的transmitterName & receiverName (覆蓋掉上面，才能顯示出最新數據)
                    document.getElementById(key).innerHTML = `${key}<br>${(tvWallInformation.get(key).transmitterName)}&nbsp&nbsp${(tvWallInformation.get(key).receiverName)}`;


                    console.log(tvWallInformation);  //抓的到，且map會自動更新到最新，最好放置位置，這個到最後要儲存起來，以免按Next鍵就消失







                  })

                } else {
                  //id符合條件才能編輯下拉式選單
                  e.disabled = true;

                }


              })

            })
          })

        }



        console.log(`arrayData${arrayData}`);



        // //功能: transmitter相同的col顯示同一個顏色
        // function transmitterColor() {
        //   //將map物件的colName和transmitterName整理成陣列
        //   const valuesArray = Array.from(tvWallInformation.values());   //不需要用...三元運算子展開tvWallInformation
        //   const transmitterGet = valuesArray.map(item => ({
        //     colName: item.colName,
        //     transmitterName: item.transmitterName
        //   }));
        //   console.log(transmitterGet);


        //   // 將所有的transmitterName的值由小到大排列，並保留 transmitterGet陣列內容
        //   const sortedTransmitterGet = [...transmitterGet].sort((a, b) => a.transmitterName.localeCompare(b.transmitterName));
        //   console.log(sortedTransmitterGet);


        //   //添加同一個Transmitter同一種背景顏色功能
        //   sortedTransmitterGet.forEach(function (item) {
        //     const element = document.getElementById(item.colName);
        //     console.log(item.colName);

        //     element.classList.remove(`${item.transmitterName}`);  //***無法remove*** 為避免更換Transmitter下拉選單無法更換顏色問題，加上監聽
        //     console.log(element);
        //     //添加同一個Transmitter同一種背景顏色功能
        //     element.classList.add(`${item.transmitterName}`);
        //   })
        // }




      </script>
</body>

</html>